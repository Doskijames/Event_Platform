{% extends "event_base.html" %}
{% block event_content %}
<div class="container">
  <div class="card">
    <div class="card-header">
      <div>
        <h2>Photos of the Day</h2>
        <p class="muted">Keep this closed until you’re ready. When open, share the upload link with guests.</p>
      </div>
    </div>

    <div class="card-body">
      <div class="card" style="padding:14px;margin-bottom:14px;">
        <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;">
          <div>
            <div><strong>Status:</strong> {% if is_open %}OPEN{% else %}CLOSED{% endif %}</div>
            <div class="muted" style="margin-top:6px;"><strong>Upload link:</strong> <span id="uploadLink">{{ upload_url }}</span></div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn" type="button" id="btnCopy">Copy link</button>

            <form method="POST" action="{{ url_for('photos_day_admin', slug=event.slug) }}" style="display:inline;">
              <input type="hidden" name="action" value="{% if is_open %}close{% else %}open{% endif %}">
              <button class="btn btn-primary" type="submit">{% if is_open %}Close{% else %}Open{% endif %}</button>
            </form>

            <form method="POST" action="{{ url_for('photos_day_admin', slug=event.slug) }}" style="display:inline;">
              <input type="hidden" name="action" value="regenerate">
              <button class="btn" type="submit">Regenerate link</button>
            </form>
          </div>
        </div>
      </div>

      <h3>Uploaded photos</h3>
      {% if photos and photos|length > 0 %}
        <div class="grid">
          {% for p in photos %}
            <div class="photo-card">
              <img src="{{ url_for('static', filename='uploads/' ~ p.filename) }}" alt="photo {{ loop.index }}">
              <div class="meta">
                <div class="muted">Uploaded by: <strong>{{ p.uploader_name or 'Guest' }}</strong></div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted">No uploads yet.</p>
      {% endif %}
    </div>
  </div>
</div>

<script>
(function(){
  const btn = document.getElementById('btnCopy');
  const link = document.getElementById('uploadLink');
  if(!btn || !link) return;
  btn.addEventListener('click', async () => {
    try{
      await navigator.clipboard.writeText(link.textContent.trim());
      btn.textContent = 'Copied ✅';
      setTimeout(()=>btn.textContent='Copy link', 1500);
    }catch(e){
      alert("Could not copy. Please copy manually.");
    }
  });
})();
</script>

<style>
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px;}
.photo-card{border:1px solid rgba(255,255,255,.08);border-radius:14px;overflow:hidden;background:rgba(0,0,0,.15);}
.photo-card img{width:100%;height:150px;object-fit:cover;display:block;}
.photo-card .meta{padding:10px;}
</style>
{% endblock %}
