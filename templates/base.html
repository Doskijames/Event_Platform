<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{% block title %}E-Accesslink{% endblock %}</title>

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <link id="themeStylesheet" rel="stylesheet"
        href="{{ url_for('static', filename='themes/black.css') }}">

  {% block head %}{% endblock %}
</head>

<body>

  <!-- TOP NAV -->
  <div class="topbar">
    <div class="nav-left">
      {% if has_endpoint('home') %}
        <a class="brand" href="{{ url_for('home') }}">E-Accesslink.ng</a>
        <a class="navlink" href="{{ url_for('home') }}">Home</a>
      {% else %}
        <a class="brand" href="/">E-Accesslink.ng</a>
      {% endif %}

      {% if has_endpoint('events') %}
        <a class="navlink" href="{{ url_for('events') }}">Events</a>
      {% elif has_endpoint('event_gate') %}
        <a class="navlink" href="{{ url_for('event_gate') }}">Events</a>
      {% endif %}
    </div>

    <div class="nav-right">
      <!-- THEME TOGGLE -->
      <div class="theme-toggle">
        <button class="theme-btn" type="button" data-theme="black">Black</button>
        <button class="theme-btn" type="button" data-theme="grey">Grey</button>
        <button class="theme-btn" type="button" data-theme="light">Light</button>
      </div>

      {% if user %}
        <span class="muted" style="font-weight:900;">{{ user.email }}</span>

        {% if has_endpoint('change_password') %}
          <a class="navlink" href="{{ url_for('change_password') }}">Change Password</a>
        {% endif %}

        {% if has_endpoint('logout') %}
          <a class="navlink" href="{{ url_for('logout') }}">Logout</a>
        {% endif %}
      {% else %}
        {% if has_endpoint('login') %}
          <a class="navlink" href="{{ url_for('login') }}">Login</a>
        {% endif %}

        {% if has_endpoint('register') %}
          <a class="navlink" href="{{ url_for('register') }}">Sign up</a>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <!-- FLASH MESSAGES -->
  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flash-wrap">
        {% for msg in messages %}
          <div class="flash">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {% block content %}{% endblock %}

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-inner">
      <div class="muted" style="font-weight:900;">
        Â© {{ (now().year if now is defined else 2025) }} E-Accesslink.ng
      </div>

      <a class="footer-ig" target="_blank" rel="noopener"
         href="https://www.instagram.com/eaccesslink.ng"
         aria-label="Instagram">
        <svg class="ig-icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm10 2H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V7a3 3 0 0 0-3-3z"/>
        </svg>
      </a>
    </div>
  </footer>

  <script>
    (function(){
      const themeLink = document.getElementById("themeStylesheet");
      const buttons = Array.from(document.querySelectorAll(".theme-btn"));
      const THEMES = {
        black: "{{ url_for('static', filename='themes/black.css') }}",
        grey:  "{{ url_for('static', filename='themes/grey.css') }}",
        light: "{{ url_for('static', filename='themes/light.css') }}"
      };

      function applyTheme(theme){
        if(!THEMES[theme]) theme = "black";
        themeLink.href = THEMES[theme];
        localStorage.setItem("theme", theme);
        buttons.forEach(b => b.classList.toggle("active", b.dataset.theme === theme));
      }

      buttons.forEach(btn => {
        btn.addEventListener("click", () => applyTheme(btn.dataset.theme));
      });

      applyTheme(localStorage.getItem("theme") || "black");
    })();
  </script>

  {% block scripts %}{% endblock %}
</body>
</html>
