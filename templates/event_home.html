{% extends "event_base.html" %}
{% block event_content %}

<!-- HERO COVER (photo + overlay text + RSVP) -->
<section class="joy-hero">

  {% if section.image %}
    <img class="joy-hero-img"
         src="{{ url_for('static', filename='uploads/' + section.image) }}"
         alt="Event hero image"
         loading="eager">
  {% else %}
    <div class="joy-hero-placeholder">
      <div>
        <h2 class="accent" style="margin:0;">Add a hero photo</h2>
        <p class="muted" style="margin:10px 0 0;">Admin / Owner can upload the celebrant/couple photo here.</p>
      </div>
    </div>
  {% endif %}

  <div class="joy-hero-overlay">
  {# Event name moved to base/topbar for public view #}
    <p class="joy-message">We canâ€™t wait to share our special day with you.</p>

    <a class="joy-cta" href="{{ url_for('event_section', slug=event.slug, section_key='rsvp') }}">
      RSVP
    </a>
  </div>

</section>

<!-- DATE / LOCATION / COUNTDOWN -->
<section class="joy-date-card">

  <div class="joy-date-weekday">{{ weekday }}</div>
  <div class="joy-date-long">{{ long_date }}</div>
  <div class="joy-date-location">{{ event.location }}</div>

  <div class="joy-countdown">
    <span class="joy-countdown-value" id="cd-days">--</span> DAYS
    <span class="joy-countdown-value" id="cd-hrs">--</span> HRS
    <span class="joy-countdown-value" id="cd-mins">--</span> MINS
  </div>

  <a class="joy-unlock" href="{{ url_for('event_section', slug=event.slug, section_key='rsvp') }}">
    RSVP
  </a>

</section>

{% if is_admin %}
  <div class="section-card" style="margin-top:16px;">
    <h3 class="accent" style="margin-top:0;">Admin / Owner Controls</h3>

    <form method="POST"
          enctype="multipart/form-data"
          action="{{ url_for('upload_section_image', slug=event.slug, section_key=section_key) }}"
          class="admin-box">
      <div class="admin-row">
        <label class="mini-label">Event Home Hero Image (Couple/Celebrant)</label>
        <input class="mini-file" type="file" name="image" required>
        <button class="btn mini-btn" type="submit">Upload</button>
      </div>
    </form>

    <form method="POST"
          action="{{ url_for('toggle_section', slug=event.slug, section_key=section_key) }}"
          class="admin-box">
      <button class="btn btn-outline" type="submit">
        {% if section.visible %}Hide Home Section{% else %}Show Home Section{% endif %}
      </button>
    </form>
  </div>
{% endif %}

<script>
  (function(){
    const targetStr = "{{ countdown_iso }}";
    if (!targetStr) return;

    const target = new Date(targetStr).getTime();
    const elDays = document.getElementById("cd-days");
    const elHrs  = document.getElementById("cd-hrs");
    const elMins = document.getElementById("cd-mins");

    function tick(){
      const now = Date.now();
      let diff = target - now;
      if (diff < 0) diff = 0;

      const minsTotal = Math.floor(diff / 60000);
      const days = Math.floor(minsTotal / (60 * 24));
      const hrs  = Math.floor((minsTotal % (60 * 24)) / 60);
      const mins = minsTotal % 60;

      elDays.textContent = String(days);
      elHrs.textContent  = String(hrs).padStart(2, "0");
      elMins.textContent = String(mins).padStart(2, "0");
    }

    tick();
    setInterval(tick, 30000);
  })();
</script>

{% endblock %}
